<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LifeQuest Mini-App</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        /* –¢–æ—Ç –∂–µ CSS —á—Ç–æ –∏ –≤ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–µ */
    </style>
</head>
<body>
    <div id="app">
        <div class="loading">
            <div class="spinner"></div>
            <p>–ó–∞–≥—Ä—É–∑–∫–∞ LifeQuest Mini-App...</p>
        </div>
    </div>

    <script>
        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
        const CONFIG = {
            apiUrl: 'https://your-bot-url.com/api',
            version: '1.0.0'
        };

        class LifeQuestApp {
            constructor() {
                this.userData = null;
                this.currentSection = 'main';
                this.init();
            }

            async init() {
                try {
                    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram WebApp
                    this.initTelegram();
                    
                    // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                    await this.loadUserData();
                    
                    // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
                    this.render();
                    
                    // –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≥–æ—Ç–æ–≤–æ
                    this.ready();
                    
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:', error);
                    this.showError('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ');
                }
            }

            initTelegram() {
                this.tg = window.Telegram.WebApp;
                this.tg.expand();
                this.tg.enableClosingConfirmation();
                
                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π Telegram
                this.tg.onEvent('viewportChanged', () => this.tg.expand());
                this.tg.onEvent('closeButtonClicked', () => this.tg.close());
            }

            async loadUserData() {
                // –ï—Å–ª–∏ –≤ —Ä–µ–∂–∏–º–µ Telegram, –ø–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –æ—Ç –±–æ—Ç–∞
                if (this.tg.initData) {
                    this.userData = await this.loadFromBot();
                } else {
                    // –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –¥–µ–º–æ
                    this.userData = this.getDemoData();
                }
            }

            async loadFromBot() {
                try {
                    // –ó–¥–µ—Å—å –±—É–¥–µ—Ç –∑–∞–ø—Ä–æ—Å –∫ API –≤–∞—à–µ–≥–æ –±–æ—Ç–∞
                    const response = await fetch(`${CONFIG.apiUrl}/user-data`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            initData: this.tg.initData
                        })
                    });
                    
                    return await response.json();
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:', error);
                    return this.getDemoData();
                }
            }

            getDemoData() {
                return {
                    user_id: 12345,
                    level: 5,
                    title: "–ò—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å", 
                    xp: 1250,
                    next_level_xp: 2000,
                    xp_progress: 62.5,
                    coins: 3250,
                    energy: 67,
                    life_goal: "–°—Ç–∞—Ç—å full-stack —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–º",
                    focus_area: "–ö–∞—Ä—å–µ—Ä–∞ –∏ IT",
                    quests: [
                        {
                            id: 1,
                            title: "–£—Ç—Ä–µ–Ω–Ω–∏–π –∫–æ–¥-–º–∞—Ä–∞—Ñ–æ–Ω",
                            description: "–í—ã–ø–æ–ª–Ω–∏—Ç–µ 3 —Ñ–æ–∫—É—Å-—Å–µ—Å—Å–∏–∏ –ø–æ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—é",
                            progress: 2,
                            target: 3,
                            xp_reward: 100,
                            coins_reward: 50
                        },
                        {
                            id: 2, 
                            title: "–ò–∑—É—á–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π",
                            description: "–ü–æ—Ç—Ä–∞—Ç—å—Ç–µ 2 —á–∞—Å–∞ –Ω–∞ –∏–∑—É—á–µ–Ω–∏–µ React",
                            progress: 1,
                            target: 2, 
                            xp_reward: 80,
                            coins_reward: 40
                        }
                    ],
                    achievements: [
                        {
                            name: "–ù–æ–≤–∏—á–æ–∫ —Ñ–æ–∫—É—Å–∞",
                            description: "–ó–∞–≤–µ—Ä—à–∏—Ç–µ 5 —Ñ–æ–∫—É—Å-—Å–µ—Å—Å–∏–π",
                            icon: "üéØ",
                            xp_reward: 100
                        },
                        {
                            name: "–≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å", 
                            description: "–ó–∞–ø–∏—à–∏—Ç–µ 10 —ç–º–æ—Ü–∏–π",
                            icon: "üòä",
                            xp_reward: 80
                        }
                    ],
                    shop_items: [
                        {
                            id: 1,
                            name: "–ë—É—Å—Ç –æ–ø—ã—Ç–∞",
                            description: "+25% –∫ –ø–æ–ª—É—á–∞–µ–º–æ–º—É –æ–ø—ã—Ç—É –Ω–∞ 24 —á–∞—Å–∞", 
                            price: 100
                        },
                        {
                            id: 2,
                            name: "–≠–Ω–µ—Ä–≥–µ—Ç–∏–∫",
                            description: "+50 —ç–Ω–µ—Ä–≥–∏–∏",
                            price: 75
                        }
                    ],
                    inventory: [
                        {
                            id: 1,
                            name: "–ë—É—Å—Ç –æ–ø—ã—Ç–∞",
                            description: "–ê–∫—Ç–∏–≤–µ–Ω –µ—â–µ 12 —á–∞—Å–æ–≤",
                            quantity: 1
                        }
                    ],
                    leaderboard: [
                        { username: "–ê–ª–µ–∫—Å–µ–π", current_level: 15, total_xp: 5000, life_coins: 2500 },
                        { username: "–ú–∞—Ä–∏—è", current_level: 12, total_xp: 3500, life_coins: 1800 },
                        { username: "–î–º–∏—Ç—Ä–∏–π", current_level: 8, total_xp: 2000, life_coins: 1200 }
                    ],
                    total_quests_completed: 12
                };
            }

            render() {
                const app = document.getElementById('app');
                app.innerHTML = this.generateHTML();
                this.attachEventListeners();
                this.animateProgressBars();
            }

            generateHTML() {
                // –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –≤ mini_app_generator.py
                // –Ω–æ —Å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–π –ø–æ–¥–≥—Ä—É–∑–∫–æ–π –¥–∞–Ω–Ω—ã—Ö
                return `
                    <div class="app-container">
                        <!-- HTML —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ -->
                    </div>
                `;
            }

            attachEventListeners() {
                // –ù–∞–≤–∏–≥–∞—Ü–∏—è
                document.querySelectorAll('.nav-button').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const section = e.target.closest('.nav-button').dataset.section;
                        this.showSection(section);
                    });
                });

                // –î–µ–π—Å—Ç–≤–∏—è
                document.querySelectorAll('[data-action]').forEach(element => {
                    element.addEventListener('click', (e) => {
                        const action = e.target.dataset.action;
                        const data = e.target.dataset;
                        this.handleAction(action, data);
                    });
                });
            }

            showSection(sectionId) {
                this.currentSection = sectionId;
                this.render();
            }

            handleAction(action, data) {
                switch(action) {
                    case 'buy_item':
                        this.buyItem(data.itemId);
                        break;
                    case 'complete_quest':
                        this.completeQuest(data.questId);
                        break;
                    case 'use_item':
                        this.useItem(data.itemId);
                        break;
                }
            }

            buyItem(itemId) {
                if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –∫—É–ø–∏—Ç—å —ç—Ç–æ—Ç –ø—Ä–µ–¥–º–µ—Ç?')) {
                    this.sendToBot('buy_item', { item_id: itemId });
                }
            }

            completeQuest(questId) {
                this.sendToBot('complete_quest', { quest_id: questId });
            }

            useItem(itemId) {
                this.sendToBot('use_item', { item_id: itemId });
            }

            sendToBot(action, data) {
                if (this.tg && this.tg.sendData) {
                    this.tg.sendData(JSON.stringify({
                        action: action,
                        ...data,
                        user_id: this.userData.user_id
                    }));
                } else {
                    // –†–µ–∂–∏–º –¥–µ–º–æ - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
                    alert(`–î–µ–π—Å—Ç–≤–∏–µ: ${action}\n–î–∞–Ω–Ω—ã–µ: ${JSON.stringify(data)}`);
                }
            }

            animateProgressBars() {
                const xpBar = document.getElementById('xpBar');
                if (xpBar) {
                    xpBar.style.width = '0%';
                    setTimeout(() => {
                        xpBar.style.width = this.userData.xp_progress + '%';
                    }, 300);
                }
            }

            ready() {
                if (this.tg && this.tg.ready) {
                    this.tg.ready();
                }
                console.log('LifeQuest Mini-App ready!');
            }

            showError(message) {
                document.getElementById('app').innerHTML = `
                    <div class="error-screen">
                        <div class="error-icon">üòî</div>
                        <h2>–û—à–∏–±–∫–∞</h2>
                        <p>${message}</p>
                        <button onclick="location.reload()">–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞</button>
                    </div>
                `;
            }
        }

        // –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        document.addEventListener('DOMContentLoaded', () => {
            new LifeQuestApp();
        });
    </script>
</body>
</html>